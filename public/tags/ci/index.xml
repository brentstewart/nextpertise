<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>CI on </title>
    <link>https://www.nextpertise.net/tags/ci/</link>
    <description>Recent content in CI on </description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 19 Sep 2020 13:18:28 -0400</lastBuildDate>
    
        <atom:link href="https://www.nextpertise.net/tags/ci/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>CI for Docs with Pandoc (take 2)</title>
      <link>https://www.nextpertise.net/posts/200919_pandoc_improved/</link>
      <pubDate>Sat, 19 Sep 2020 13:18:28 -0400</pubDate>
      
      <guid>https://www.nextpertise.net/posts/200919_pandoc_improved/</guid>
      <description>&lt;p&gt;In a previous &lt;a href=&#34;https://www.nextpertise.net/Pandoc&#34;&gt;post&lt;/a&gt;, I built out a Continuous Integration process for documentation. That process allowed the team to pull a Github repository and keep a local copy of documentation. As the markdown files were updated and the repository pushed, a clean PDF with table of contents was generated.
I identified a few problems with that and I&amp;rsquo;ve been working to improve the process. If you take a look at the associated github project you can follow my struggles. Here&amp;rsquo;s where we are with the open issues from last time:&lt;/p&gt;
&lt;p&gt;The generated document placed the cover &lt;em&gt;after&lt;/em&gt; the table of contents. It also include the github README.md in the generated file. The Github CI process uses &lt;em&gt;.github/workflows/test.yml&lt;/em&gt; to build the workflow and my file pulled in all the markdown files alphabetically.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\-&lt;/span&gt; run: echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;::set-env name=FILELIST::\$(printf &amp;#39;%s &amp;#39; \*.md)&amp;#34;&lt;/span&gt;

with:  
  args: --template eisvogel2.tex --o output/result.pdf &lt;span style=&#34;color:#ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;{{&lt;/span&gt;env.FILELIST&lt;span style=&#34;color:#f92672&#34;&gt;}}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I fixed this by changing FILELIST to use &lt;strong&gt;d*.md&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;I was also able to improve the output a little by generating a default latex layout.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;pandoc -D latex &amp;gt; ~/next.latex 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I also found that including YAML headers in the markdown transferred over to the output. Pandoc only takes the first headers it finds, so I placed my files in doc0.md. I was able to transfer all my customizations from the latex file to the YAML, which is much cleaner to maintain. Here&amp;rsquo;s a version of that file.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;---
&lt;span style=&#34;color:#f92672&#34;&gt;title&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;My Sample Doc&amp;#34;&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;subtitle&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;author&lt;/span&gt;: [&lt;span style=&#34;color:#ae81ff&#34;&gt;Brent Stewart]  &lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;date&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2020-09-18&amp;#34;&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;abstract&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;|  &lt;/span&gt;
&lt;span style=&#34;color:#ae81ff&#34;&gt;This is a sample document used to demonstrate documentation via pandoc and Github.  &lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;keywords&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;institute&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nextpertise.Net&amp;#34;&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;numbersections&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;toc&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;geometry&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;margin=2.5cm  &lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;header-include&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;\pagebreak  &lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;include-before&lt;/span&gt;:  
&lt;span style=&#34;color:#f92672&#34;&gt;include-after&lt;/span&gt;:  
&lt;span style=&#34;color:#f92672&#34;&gt;logo&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Feed-icon.png&amp;#34;&lt;/span&gt;  
&lt;span style=&#34;color:#f92672&#34;&gt;header-includes&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;|  &lt;/span&gt;
 &lt;span style=&#34;color:#ae81ff&#34;&gt;\usepackage{fancyhdr}  &lt;/span&gt;
 &lt;span style=&#34;color:#ae81ff&#34;&gt;\pagestyle{fancy}  &lt;/span&gt;
 &lt;span style=&#34;color:#ae81ff&#34;&gt;\lfoot{Prepared September 18th, 2020}  &lt;/span&gt;
 &lt;span style=&#34;color:#ae81ff&#34;&gt;\rfoot{Page \thepage}  &lt;/span&gt;
 &lt;span style=&#34;color:#ae81ff&#34;&gt;\cfoot{}&lt;/span&gt;
---
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice that this also cleaned up the command line used to invoke pandoc,as things like the Table of Contents directive were moved to YML. You can also use this technique to change fonts, margins, headers, and such.&lt;/p&gt;
&lt;h2 id=&#34;whats-not-working&#34;&gt;What&amp;rsquo;s &lt;strong&gt;not&lt;/strong&gt; working&lt;/h2&gt;
&lt;p&gt;That the good news. Using the existing directions and my &lt;strong&gt;mymeta.md&lt;/strong&gt; example, you can get a nice clean output. What&amp;rsquo;s not working is having a cover page. That led me into customizing the latex file, which led me to find the eisvogeltemplate project. Pascal Wagler has developed a &lt;em&gt;very&lt;/em&gt; nice and usable latex template (it&amp;rsquo;s currently in my github project). I was able to use it locally and output wonderful PDFs. It has some dependencies that required I grab the full latex distribution (apt install texlive-full), but otherwise no problems.&lt;/p&gt;
&lt;p&gt;I wanted to update the pandoc Docker file to support the eisvogel template. I made a custom Dockerfile to pull pandoc/ubuntu-latex
and add in the full set of texlive files.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-tex&#34; data-lang=&#34;tex&#34;&gt;from pandoc/ubuntu-latex  
run apt update &amp;amp;&amp;amp; apt install texlive-full texlive-full -y
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This was then built and pushed to Docker hub.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-docker&#34; data-lang=&#34;docker&#34;&gt;docker build --tag&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;pandoc_texlive:1.0&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;docker push brentstewart/pandoc_texlive:1.0&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I went back to github and updated the CI action to use the new docker file and to run &lt;strong&gt;pandoc &amp;ndash;template eisvogel.tex -o Output/result.pdf d*.md&lt;/strong&gt; and . . . didn&amp;rsquo;t work! I keep getting:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-tex&#34; data-lang=&#34;tex&#34;&gt;! LaTeX Error: File `adjustbox.sty&amp;#39; not found.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This works on my local system, but it doesn&amp;rsquo;t work if I run docker locally with my image. The default pandoc images don&amp;rsquo;t have the required files either.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;ve tried rebuilding Docker with just the texlive-extras (a smaller set of Latex files). I tried editing the latex to remove the dependencies. So far nothing has worked.&lt;/p&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Good progress was made on the project. I improved the CI output and simplified the CI process by using the default docker file and by supplying instructions in YAML. I also was able to produce really nice PDFs locally using the eisvogel.tex template.&lt;/p&gt;
&lt;p&gt;Trying to duplicate this last step on Github failed because I&amp;rsquo;m missing includes in the docker system, and trying to update that Docker system has been a source of frustration! I&amp;rsquo;ll update this when I have some more time, but we&amp;rsquo;re getting close.&lt;/p&gt;
&lt;p&gt;If anyone out there want&amp;rsquo;s to take a look at the github project and the docker image, I&amp;rsquo;d welcome your thoughts!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Team Documentation Using GitHub and Pandoc</title>
      <link>https://www.nextpertise.net/posts/200818_pandoc/</link>
      <pubDate>Tue, 18 Aug 2020 13:56:30 -0400</pubDate>
      
      <guid>https://www.nextpertise.net/posts/200818_pandoc/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;https://thumbs.gfycat.com/GargantuanScaryAnura-max-1mb.gif#floatleft&#34; alt=&#34;Dean Wormer&#34;&gt;
Building team documentation is a critical part of IT.  After all, you can&amp;rsquo;t manage what you don&amp;rsquo;t know about.  You can&amp;rsquo;t follow policies you don&amp;rsquo;t know about.  It&amp;rsquo;s common in IT that documentation is divided between shared files and updated copies on individual laptops.  The problem is that it&amp;rsquo;s difficult for any one person to collect all the most recent files.  I&amp;rsquo;ve learned a lot about Git in the last few years and I wanted to explore whether it could be an answer.&lt;/p&gt;
&lt;p&gt;Various attempts have been made to resolve this versioning issue.  One common approach is to ask everyone to contribute their individual documents to a shared folder.  This has the advantage that everyone can be a contributor and the files are accessible and easy to update.  However, different team members may update the file at different times and in different ways and there&amp;rsquo;s no clear editorial process to bring everything back together.  A second approach is to have a strict editorial process &amp;ndash; maybe a dedicated person who &amp;ldquo;checks in&amp;rdquo; so the boss can &amp;ldquo;approve&amp;rdquo;.  There&amp;rsquo;s typically a drop box for proposed documents and then a locked-down directory with a PDF for the final version.  This process can take a while, can occupy a person, and is discouraging to contributors.&lt;/p&gt;
&lt;p&gt;Using Git has a lot of advantages.  Everyone can have an up-to-date copy using &lt;strong&gt;git clone&lt;/strong&gt; and &lt;strong&gt;git fetch&lt;/strong&gt;.  Team members can edit documents and submit them as Pull Requests (PRs).  There&amp;rsquo;s a built in process for the repo owner to accept or reject those changes.  GitHub already has an issues process that would make it easy to note deficiencies and discrepancies.  Finally, Github repos can be marked private, are available even when internal systems are down, and maintain historical versions.&lt;/p&gt;
&lt;p&gt;Having a repository of Word files would be useful, but formatting can be maddening.  All those files will use different fonts, sizes, margins, colors, headings . . . sigh.  Another problem is that you&amp;rsquo;ll have a directory full of files with names like &lt;strong&gt;ITPROC1.docx&lt;/strong&gt;.  As an administrator, I would like to have one place where I can easily browse through documentation and be confident that I&amp;rsquo;m up to date!&lt;/p&gt;
&lt;p&gt;My proposal is to use Markdown files for documentation.  They&amp;rsquo;re easy to create and reasonably readable in a text editor.  As pushes or PRs occur, these files can be combined into a PDF using &lt;strong&gt;pandoc&lt;/strong&gt;.  I&amp;rsquo;ve built a demonstration of this in the referenced Github repository.  There&amp;rsquo;s a Continuous Integration (CI) process built out of Github Actions.  Setting that up adds a &lt;em&gt;.github/workflows/name.yaml&lt;/em&gt; file to your repository.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Be careful!&lt;/strong&gt;  &lt;em&gt;I originally built my repository locally and pushed it to Github, then used the Github actions &amp;ldquo;wizard&amp;rdquo; to setup the CI process.  That builds an initial configuration file for you and puts it into your repository.  The next time I pushed, this directory and file were wiped out!  The result was that the CI process didn&amp;rsquo;t run and it took me a while to understand what I had done.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Here&amp;rsquo;s my YAML file to handle the CI process.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;CI  &lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;on&lt;/span&gt;:  
 &lt;span style=&#34;color:#f92672&#34;&gt;push&lt;/span&gt;:  
   &lt;span style=&#34;color:#f92672&#34;&gt;branches&lt;/span&gt;: [ &lt;span style=&#34;color:#ae81ff&#34;&gt;master ]  &lt;/span&gt;
 &lt;span style=&#34;color:#f92672&#34;&gt;pull_request&lt;/span&gt;:  
   &lt;span style=&#34;color:#f92672&#34;&gt;branches&lt;/span&gt;: [ &lt;span style=&#34;color:#ae81ff&#34;&gt;master ]  &lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;jobs&lt;/span&gt;:  
  &lt;span style=&#34;color:#f92672&#34;&gt;build&lt;/span&gt;:  
   &lt;span style=&#34;color:#f92672&#34;&gt;runs-on&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ubuntu-latest  &lt;/span&gt;
   &lt;span style=&#34;color:#f92672&#34;&gt;steps&lt;/span&gt;:  
    &lt;span style=&#34;color:#f92672&#34;&gt;\- uses&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;actions/checkout@v2  &lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;\- run&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;echo &amp;#34;::set-env name=FILELIST::$(printf &amp;#39;%s &amp;#39; *.md)&amp;#34;  &lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;\- uses&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;docker://pandoc/latex:2.9  &lt;/span&gt;
   &lt;span style=&#34;color:#f92672&#34;&gt;with&lt;/span&gt;:  
    &lt;span style=&#34;color:#f92672&#34;&gt;args&lt;/span&gt;: --&lt;span style=&#34;color:#ae81ff&#34;&gt;toc --output=output/result.pdf ${{env.FILELIST}}  &lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;\- uses&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;actions/upload-artifact@master  &lt;/span&gt;
   &lt;span style=&#34;color:#f92672&#34;&gt;with&lt;/span&gt;:  
    &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;output  &lt;/span&gt;
    &lt;span style=&#34;color:#f92672&#34;&gt;path&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;output  &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://www.nextpertise.net/githubartifact.png#floatright&#34; alt=&#34;Artifact&#34;&gt;
This process will pull all the md files into a PDF, ordering them alphabetically.  It will then add a table of contents to the front, based on headings found in the files.  I&amp;rsquo;ve cribbed this together using the pandoc example on github (referenced below).&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.nextpertise.net/result.pdf&#34;&gt;result&lt;/a&gt; is a zip file named &lt;em&gt;output&lt;/em&gt; that will show up under Actions.  The latest run should be at the top of the screen, and clicking the link should show you the Artifacts produced.  Note that if there are problems with the CI process, you can review those by looking at the &lt;em&gt;build&lt;/em&gt; section.  You could add to the CI process to have the output file emailed to you or stored in a convenient place.  For instance, you could send the PDF directly to your Kindle!  I&amp;rsquo;ve chosen not to bother with that since this is a public repository.  Another idea would be to have this process output HTML files that could be placed on a local web server.  Pandoc can handle PDF, HTML, EPUB, and a lot of other formats.&lt;/p&gt;
&lt;p&gt;My repository is public and you are welcome to clone it and play with this process.  The markdown files currently in place are filled with Lorem Ipsum nonsense but they give you a sense of how it might look as a finished PDF.  I&amp;rsquo;d like to build in an automatic way to add a cover page.  The Pandoc documentation also references using a CSS file to dictate formatting when outputting to EPUB, so I&amp;rsquo;d like to see if I could get that supported in PDF.  PRs are welcome if you have any ideas!&lt;/p&gt;
&lt;p&gt;What do you think?  Would this be a good way for your IT group to maintain documentation?  I&amp;rsquo;d welcome your comments in the section below!&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
